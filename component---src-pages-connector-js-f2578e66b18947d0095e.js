(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"0chk":function(e,t,n){"use strict";n.r(t);n("f3/d"),n("a1Th"),n("XfO3"),n("HEwt"),n("rE2o"),n("ioFf"),n("VRzm"),n("rGqo"),n("yt8O"),n("Btvt"),n("KKXr");var a=n("o0o1"),o=n.n(a),r=(n("ls82"),n("q1tI")),i=n.n(r),s=n("3r0M"),c=n("XyXI"),l=n("iUi7"),u=n("/Ina"),d=n("wX7S"),p=n("iY3s"),h=n("Skks"),m=n("mFTT"),f=n("WZt7");function y(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t,n,a,o,r,i){try{var s=e[r](i),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(a,o)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var r=e.apply(t,n);function i(e){g(r,a,o,i,s,"next",e)}function s(e){g(r,a,o,i,s,"throw",e)}i(void 0)}))}}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var w=function(e){return null==e||0==e.length},E={mainPadding:{padding:"0px 2em"},mainSidePadding:{padding:"10px 2em"},mainPdf:{display:"flex",justifyContent:"center"},mainTable:{backgroundColor:"#fff",border:"1px solid #d8e2f0",borderRadius:"4px",boxShadow:"0 0 10px 0 rgba(19,29,41,.05)",position:"relative",padding:"0em 3em 2em"},backButton:{cusor:"pointer"},label:{fontWeight:"bold"}},S={en:{heading:"Moneybird Configuration",apiSection:{title:i.a.createElement("label",{style:E.label},"API Token"),description:i.a.createElement("span",null,"This is the API Token for you MoneyBird Account. You can generate one ",i.a.createElement("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"here")," for personal use."),succsess:"API Token is vaild",fail:"API Token NOT vaild",placeholder:"API Token",show:"Click to choose another api key"},contactSection:{title:i.a.createElement("label",{style:E.label},"Contact"),description:i.a.createElement("span",null,"The contact whos data will show up on the tab"),placeholder:"Choose a Contact"},typeSection:{title:i.a.createElement("label",{style:E.label},"Data Type"),description:i.a.createElement("span",null,"The types of data to show notifcations for")},deleteDialog:{cancel:"Cancel",confirm:"Yes",header:"Delete API Key",message:function(e){return"Are you sure you want to delete "+e}},tabs:["Invoices","Quotes"]},nl:{heading:"Moneybird Koppelen",apiSection:{title:i.a.createElement("label",{style:E.label},"API token invoeren"),description:i.a.createElement("span",null,"Vul hier een API-token in van je Moneybird account. Je kunt ",i.a.createElement("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"hier")," een API-token genereren. Vul een naam in die herkenbaar is voor deze connectie, bijvoorbeeld ‘Microsoft Teams Integratie’. Kies voor ‘API token voor persoonlijk gebruik’ en geef toegang voor alle onderdelen. Vervolgens verschijnt er een API-token in beeld. Vul deze hieronder in."),succsess:"API-token is geldig",fail:"API-token niet geldig",placeholder:"API token invoeren",show:"Klik om een ​​andere API-sleutel te kiezen"},contactSection:{title:i.a.createElement("label",{style:E.label},"Contact"),description:i.a.createElement("span",null,"Selecteer de Contact waarvan je de gegevens wilt tonen in de Tab."),placeholder:"Kies een Contact"},typeSection:{title:i.a.createElement("label",{style:E.label},"Data Type"),description:i.a.createElement("span",null,"Het type gegevens dat op het tabblad moet worden weergegeven")},deleteDialog:{cancel:"Annuleren",confirm:"Ja",header:"API-sleutel verwijderen",message:function(e){return"Weet je zeker dat je wilt verwijderen "+e}},tabs:["Facturen","Offertes"]}},x=function(e){var t,n;function a(){var t;return(t=e.call(this)||this).microsoftTeams&&t.microsoftTeams.initialize(),t.state={apiKey:"",adminId:null,admins:null,admin:null,contacts:null,contact:null,loadingContacts:!1,keys:[],isNew:!1,isOpen:!1,isContactsOpen:!1,locale:null,tabType:"invoices",showApiKeys:!1,loaded:!1,forHours:!1,forInvoices:!1,forQuotes:!1},t.addWebhookToMoneybird=t.addWebhookToMoneybird.bind(k(t)),t.setUpWebhook=t.setUpWebhook.bind(k(t)),t.deleteKeyFromDb=t.deleteKeyFromDb.bind(k(t)),t.createKeyEntry=t.createKeyEntry.bind(k(t)),t.getAdmin=t.getAdmin.bind(k(t)),t.getOptions=t.getOptions.bind(k(t)),t.getContacts=t.getContacts.bind(k(t)),t.getAdminAndContacts=t.getAdminAndContacts.bind(k(t)),t.updateContact=t.updateContact.bind(k(t)),t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=a.prototype;return r.componentDidMount=function(){var e=v(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.microsoftTeams=window?window.microsoftTeams:null,this.microsoftTeams.initialize(),this.microsoftTeams.getContext(function(){var e=v(o.a.mark((function e(n){var a,r,s,c,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.tid,r=n.locale,e.prev=1,e.next=4,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/key/"+a,{mode:"cors",method:"GET"});case 4:return s=e.sent,e.next=7,s.json();case 7:c=e.sent,console.log({json:c}),l=c.map((function(e){return{content:i.a.createElement("div",null,i.a.createElement("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e.key,isOpen:!1})}})," - ",i.a.createElement("span",{style:{cursor:"pointer"},onClick:v(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getAdminAndContacts(e.key);case 2:case"end":return n.stop()}}),n)})))},e.key)),key:e.key}})),console.log({keys:l}),t.setState({keys:l,tid:a,locale:r}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log("BOO"),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}().bind(this));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getForDataTypes=function(){var e=this.state,t=e.forInvoices,n=e.forQuotes,a=e.forHours,o=[],r=[];return t&&(o.push("i"),r.push("sales_invoice_created")),n&&(o.push("q"),r.push("estimate_created")),a&&(o.push("h"),r.push("time_entry_created")),{urlParam:o.join("-"),events:r}},r.getAdminAndContacts=function(){var e=v(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAdmin(t);case 2:return e.sent,e.next=5,this.getContacts();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.updateContact=function(e,t){var n=this,a=t.value,o=this.state.apiKey;this.setState({contact:a},(function(){return n.setUpWebhook(o)}))},r.getContacts=function(){var e=v(o.a.mark((function e(t,n){var a,r,i,s,c,l,u,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.state,r=a.apiKey,i=a.adminId,!n){e.next=21;break}return s=n.searchQuery,e.prev=3,this.setState({loadingContacts:!0}),e.next=7,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:i+"/contacts.json"+(w(s)?"":"?query="+s),key:r})});case 7:return c=e.sent,e.next=10,c.json();case 10:l=e.sent,console.log({json:l}),this.setState({contacts:l,loadingContacts:!1}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("BOOM!"),console.log(e.t0);case 19:e.next=33;break;case 21:if(!t){e.next=25;break}this.setState({contact:t.value},this.save),e.next=33;break;case 25:return e.next=27,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:i+"/contacts.json",key:r})});case 27:return u=e.sent,e.next=30,u.json();case 30:d=e.sent,console.log({json:d}),this.setState({contacts:d,isOpen:!1});case 33:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t,n){return e.apply(this,arguments)}}(),r.addWebhookToMoneybird=function(){var e=v(o.a.mark((function e(t,n,a,r){var i,s,c,l,u,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.state,s=i.locale,c=i.contact,l=c.value,console.log("AHHHHHHH!!!"),console.log({events:r}),console.log({locale:s}),console.log({contactId:l}),console.log("https://moneybirdhandlerproxy.azurewebsites.net/api/teams/"+u+"/"+r.urlParam+"/"+l+"/"+a),u=s?s.split("-")[0]:"en",e.next=10,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"POST",path:n+"/webhooks.json",key:t,data:{url:"https://moneybirdhandlerproxy.azurewebsites.net/api/teams/"+u+"/"+r.urlParam+"/"+l+"/"+a,events:r.events}})});case 10:return d=e.sent,console.log("AHHHHHHH!!!"),e.next=14,d.json();case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),r.getAdmin=function(){var e=v(o.a.mark((function e(t,n){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!1),e.prev=1,e.next=4,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:"administrations.json",key:t})});case 4:return a=e.sent,e.next=7,a.json();case 7:if(!(r=e.sent).error){e.next=12;break}this.setState({admins:!1,isOpen:!1,contacts:null}),e.next=14;break;case 12:return this.setState({admin:r[0],adminId:r[0].id,admins:!0}),e.abrupt("return",r[0].id);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(t,n){return e.apply(this,arguments)}}(),r.setUpWebhook=function(){var e=v(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({apiKey:t,isOpen:!1}),console.log("SETUPWEBHOOK"),this.microsoftTeams.settings.setValidityState(!0),console.log("saved"),this.microsoftTeams.settings.registerOnSaveHandler(function(e){console.log("REGISTERSAVEHANDLER"),n.microsoftTeams.getContext(function(a){console.log("GETCONTEXT");var r=a.teamId,i=a.channelId,s=n.getForDataTypes();if(w(s.urlParam))e.notifyFailure("Must select a event type to recive notifcations");else{var c="connector-moneybird-"+r+"-"+i;n.microsoftTeams.settings.setSettings({contentUrl:"https://jp5525.github.io/teams-demo/connector",entityId:c,configName:"Moneybird"}),n.microsoftTeams.settings.getSettings(function(){var a=v(o.a.mark((function a(r){var i,c,l,u,d;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=r.webhookUrl,c=/webhook\/(.*)/.exec(i),l=encodeURIComponent(c[1]),console.log({webhookUrl:i}),a.next=6,n.getAdmin(t);case 6:return u=a.sent,a.next=9,n.addWebhookToMoneybird(t,u,encodeURIComponent(l),s);case 9:d=a.sent,console.log({webhook:d}),e.notifySuccess();case 12:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}}.bind(n))}.bind(this));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.deleteKeyFromDb=function(){var e=v(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.deleteKey,a=t.keys,w(n)){e.next=5;break}return e.next=4,fetch("https://moneybirdhandlerproxy.azurewebsites.net/api/key/"+n,{mode:"cors",method:"DELETE"});case 4:this.setState({deleteKey:null,apiKey:"",keys:a.filter((function(e){return e.key!=n}))});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.createKeyEntry=function(e){var t=this;return{content:i.a.createElement("div",null,i.a.createElement("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e})}})," - ",i.a.createElement("span",{style:{cursor:"pointer"},onClick:function(){return t.handleToken(e)}},e)),key:e}},r.getOptions=function(){return this.state.contacts.map((function(e){return{content:e.company_name,value:e.id}}))},r.render=function(){var e=this,t=this.state,n=t.contacts,a=t.contact,o=t.admins,r=(t.admin,t.apiKey),b=t.keys,g=t.isOpen,v=t.locale,k=t.loadingContacts,x=(t.showApiKeys,t.deleteKey),T=t.forHours,C=t.forInvoices,A=t.forQuotes;console.log({locale:v});var I=v?S[v.split("-")[0]]:null;I&&(I.tabs[0],I.tabs[1]);return I?i.a.createElement(s.a,{theme:c.themes.teams},i.a.createElement("div",{style:E.mainPadding},i.a.createElement("div",{style:E.mainTable},i.a.createElement(l.a,{content:I.heading}),i.a.createElement(u.a,{gap:"gap.small",vAlign:"center",hAlign:"start"},i.a.createElement(d.a,{justifyContent:"center"},i.a.createElement("form",{style:{width:"100%"}},I.apiSection.title," ",i.a.createElement("br",null),I.apiSection.description,0==o?i.a.createElement(i.a.Fragment,null," ",i.a.createElement("br",null),i.a.createElement(p.a,{content:I.apiSection.fail,style:{background:"#cc4a31",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,o?i.a.createElement(i.a.Fragment,null," ",i.a.createElement("br",null),i.a.createElement(p.a,{content:I.apiSection.succsess,style:{background:"#7fba00",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,i.a.createElement(h.a,{items:b,placeholder:I.apiSection.placeholder,onOpenChange:function(){return e.setState({isOpen:!g})},name:"apiKey",id:"apiKey",clearable:r&&r.length>0,fluid:!0,search:!0,open:g,searchQuery:r,itemToString:function(e){return e?e.key:""},onSearchQueryChange:function(t,n){return e.setState({apiKey:n.searchQuery})},noResultsMessage:{content:"Add... "+r,onClick:function(t){e.setState({isNew:!0,keys:[e.createKeyEntry(r)].concat(y(b)),isOpen:!1})},style:{cursor:"pointer"},active:!0}}),i.a.createElement("br",null),I.contactSection.title," ",i.a.createElement("br",null),I.contactSection.description,i.a.createElement(h.a,{ref:function(t){return e.drop=t},items:n?this.getOptions():[],value:a?a.content:null,placeholder:I.contactSection.placeholder,search:!0,loading:k,loadingMessage:"Loading...",onSearchQueryChange:this.getContacts,onChange:this.updateContact,name:"contact",disabled:!n,itemToString:function(e){return e?e.content:""},fluid:!0}),i.a.createElement("br",null),I.typeSection.title," ",i.a.createElement("br",null),I.typeSection.description," ",i.a.createElement("br",null),i.a.createElement(m.a,{label:"Invoices",checked:C,onChange:function(){return e.setState({forInvoices:!C})}}),i.a.createElement(m.a,{label:"Quotes",checked:A,onChange:function(){return e.setState({forQuotes:!A})}}),i.a.createElement(m.a,{label:"Hours",checked:T,onChange:function(){return e.setState({forHours:!T})}}),i.a.createElement(f.a,{cancelButton:I.deleteDialog.cancel,onCancel:function(){return e.setState({deleteKey:null})},confirmButton:I.deleteDialog.confirm,onConfirm:this.deleteKeyFromDb,content:I.deleteDialog.message(x),header:I.deleteDialog.header,open:!w(x),backdrop:!0}))))))):null},a}(i.a.Component);t.default=x}}]);
//# sourceMappingURL=component---src-pages-connector-js-f2578e66b18947d0095e.js.map