(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"0chk":function(e,t,n){"use strict";n.r(t);var a=n("KQm4"),o=n("o0o1"),r=n.n(o),s=(n("ls82"),n("HaE+")),i=n("JX7q"),c=n("dI71"),l=n("q1tI"),u=n.n(l),d=n("3r0M"),p=n("YIMM"),m=n("iUi7"),h=n("/Ina"),y=n("wX7S"),f=n("iY3s"),b=n("Skks"),g=n("mFTT"),k=n("WZt7"),v=function(e){return null==e||0==e.length},w={mainPadding:{padding:"0px 2em"},mainSidePadding:{padding:"10px 2em"},mainPdf:{display:"flex",justifyContent:"center"},mainTable:{backgroundColor:"#fff",border:"1px solid #d8e2f0",borderRadius:"4px",boxShadow:"0 0 10px 0 rgba(19,29,41,.05)",position:"relative",padding:"0em 3em 2em"},backButton:{cusor:"pointer"},label:{fontWeight:"bold"}},E={en:{heading:"Moneybird Configuration",apiSection:{title:u.a.createElement("label",{style:w.label},"API Token"),description:u.a.createElement("span",null,"This is the API Token for you MoneyBird Account. You can generate one ",u.a.createElement("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"here")," for personal use."),succsess:"API Token is vaild",fail:"API Token NOT vaild",placeholder:"API Token",show:"Click to choose another api key"},contactSection:{title:u.a.createElement("label",{style:w.label},"Contact"),description:u.a.createElement("span",null,"The contact whos data will show up on the tab"),placeholder:"Choose a Contact"},typeSection:{title:u.a.createElement("label",{style:w.label},"Data Type"),description:u.a.createElement("span",null,"The types of data to show notifcations for")},deleteDialog:{cancel:"Cancel",confirm:"Yes",header:"Delete API Key",message:function(e){return"Are you sure you want to delete "+e}},types:["Invoices","Quotes","Hours"]},nl:{heading:"Moneybird Koppelen",apiSection:{title:u.a.createElement("label",{style:w.label},"API token invoeren"),description:u.a.createElement("span",null,"Vul hier een API-token in van je Moneybird account. Je kunt ",u.a.createElement("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"hier")," een API-token genereren. Vul een naam in die herkenbaar is voor deze connectie, bijvoorbeeld ‘Microsoft Teams Integratie’. Kies voor ‘API token voor persoonlijk gebruik’ en geef toegang voor alle onderdelen. Vervolgens verschijnt er een API-token in beeld. Vul deze hieronder in."),succsess:"API-token is geldig",fail:"API-token niet geldig",placeholder:"API token invoeren",show:"Klik om een ​​andere API-sleutel te kiezen"},contactSection:{title:u.a.createElement("label",{style:w.label},"Contact"),description:u.a.createElement("span",null,"Selecteer de Contact waarvan je de gegevens wilt tonen in de Tab."),placeholder:"Kies een Contact"},typeSection:{title:u.a.createElement("label",{style:w.label},"Data Type"),description:u.a.createElement("span",null,"Het type gegevens dat op het tabblad moet worden weergegeven")},deleteDialog:{cancel:"Annuleren",confirm:"Ja",header:"API-sleutel verwijderen",message:function(e){return"Weet je zeker dat je wilt verwijderen "+e}},types:["Facturen","Offertes","Uren"]}},x=function(e){function t(){var t;return(t=e.call(this)||this).microsoftTeams&&t.microsoftTeams.initialize(),t.state={apiKey:"",adminId:null,admins:null,admin:null,contacts:null,contact:null,loadingContacts:!1,keys:[],isNew:!1,isOpen:!1,isContactsOpen:!1,locale:null,tabType:"invoices",showApiKeys:!1,loaded:!1,forHours:!1,forInvoices:!1,forQuotes:!1},t.addWebhookToMoneybird=t.addWebhookToMoneybird.bind(Object(i.a)(t)),t.setUpWebhook=t.setUpWebhook.bind(Object(i.a)(t)),t.deleteKeyFromDb=t.deleteKeyFromDb.bind(Object(i.a)(t)),t.createKeyEntry=t.createKeyEntry.bind(Object(i.a)(t)),t.getAdmin=t.getAdmin.bind(Object(i.a)(t)),t.getOptions=t.getOptions.bind(Object(i.a)(t)),t.getContacts=t.getContacts.bind(Object(i.a)(t)),t.getAdminAndContacts=t.getAdminAndContacts.bind(Object(i.a)(t)),t.updateContact=t.updateContact.bind(Object(i.a)(t)),t}Object(c.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=Object(s.a)(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.microsoftTeams=window?window.microsoftTeams:null,this.microsoftTeams.initialize(),this.microsoftTeams.getContext(function(){var e=Object(s.a)(r.a.mark((function e(n){var a,o,i,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.tid,o=n.locale,e.prev=1,e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/key/"+a,{mode:"cors",method:"GET"});case 4:return i=e.sent,e.next=7,i.json();case 7:c=e.sent,console.log({json:c}),l=c.map((function(e){return{content:u.a.createElement("div",null,u.a.createElement("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e.key,isOpen:!1})}})," - ",u.a.createElement("span",{style:{cursor:"pointer"},onClick:Object(s.a)(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getAdminAndContacts(e.key);case 2:case"end":return n.stop()}}),n)})))},e.key)),key:e.key}})),console.log({keys:l}),t.setState({keys:l,tid:a,locale:o}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log("BOO"),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}().bind(this));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getForDataTypes=function(){var e=this.state,t=e.forInvoices,n=e.forQuotes,a=e.forHours,o=[],r=[];return t&&(o.push("i"),r.push("sales_invoice_created")),n&&(o.push("q"),r.push("estimate_created")),a&&(o.push("h"),r.push("time_entry_created"),r.push("time_entry_updated")),{urlParam:o.join("-"),events:r}},n.getAdminAndContacts=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAdmin(t);case 2:return e.sent,e.next=5,this.getContacts();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.updateContact=function(e,t){var n=this,a=t.value,o=this.state.apiKey;this.setState({contact:a},(function(){return n.setUpWebhook(o)}))},n.getContacts=function(){var e=Object(s.a)(r.a.mark((function e(t,n){var a,o,s,i,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.state,o=a.apiKey,s=a.adminId,!n){e.next=21;break}return i=n.searchQuery,e.prev=3,this.setState({loadingContacts:!0}),e.next=7,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:s+"/contacts.json"+(v(i)?"":"?query="+i),key:o})});case 7:return c=e.sent,e.next=10,c.json();case 10:l=e.sent,console.log({json:l}),this.setState({contacts:l,loadingContacts:!1}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("BOOM!"),console.log(e.t0);case 19:e.next=33;break;case 21:if(!t){e.next=25;break}this.setState({contact:t.value},this.save),e.next=33;break;case 25:return e.next=27,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:s+"/contacts.json",key:o})});case 27:return u=e.sent,e.next=30,u.json();case 30:d=e.sent,console.log({json:d}),this.setState({contacts:d,isOpen:!1});case 33:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t,n){return e.apply(this,arguments)}}(),n.addWebhookToMoneybird=function(){var e=Object(s.a)(r.a.mark((function e(t,n,a,o){var s,i,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.state,i=s.locale,c=s.contact,l=c.value,console.log("AHHHHHHH!!!"),console.log({events:o}),console.log({locale:i}),console.log({contactId:l}),console.log("https://moneybirdproxymaatwerk.azurewebsites.net/api/teams/"+u+"/"+o.urlParam+"/"+l+"/"+a),u=i?i.split("-")[0]:"en",e.next=10,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"POST",path:n+"/webhooks.json",key:t,data:{url:"https://moneybirdproxymaatwerk.azurewebsites.net/api/teams/"+u+"/"+o.urlParam+"/"+l+"/"+a,events:o.events}})});case 10:return d=e.sent,console.log("AHHHHHHH!!!"),e.next=14,d.json();case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),n.getAdmin=function(){var e=Object(s.a)(r.a.mark((function e(t,n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!1),e.prev=1,e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:"administrations.json",key:t})});case 4:return a=e.sent,e.next=7,a.json();case 7:if(!(o=e.sent).error){e.next=12;break}this.setState({admins:!1,isOpen:!1,contacts:null}),e.next=14;break;case 12:return this.setState({admin:o[0],adminId:o[0].id,admins:!0}),e.abrupt("return",o[0].id);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setUpWebhook=function(){var e=Object(s.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({apiKey:t,isOpen:!1}),console.log("SETUPWEBHOOK"),this.microsoftTeams.settings.setValidityState(!0),console.log("saved"),this.microsoftTeams.settings.registerOnSaveHandler(function(e){console.log("REGISTERSAVEHANDLER"),n.microsoftTeams.getContext(function(a){console.log("GETCONTEXT");var o=a.teamId,i=a.channelId,c=n.getForDataTypes();if(v(c.urlParam))e.notifyFailure("Must select a event type to recive notifcations");else{var l="connector-moneybird-"+o+"-"+i;n.microsoftTeams.settings.setSettings({contentUrl:"https://jp5525.github.io/teams-demo/connector",entityId:l,configName:"Moneybird"}),n.microsoftTeams.settings.getSettings(function(){var a=Object(s.a)(r.a.mark((function a(o){var s,i,l,u,d;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=o.webhookUrl,i=/webhook\/(.*)/.exec(s),l=encodeURIComponent(i[1]),console.log({webhookUrl:s}),a.next=6,n.getAdmin(t);case 6:return u=a.sent,a.next=9,n.addWebhookToMoneybird(t,u,encodeURIComponent(l),c);case 9:d=a.sent,console.log({webhook:d}),e.savenotifyAppLoaded(),e.notifySuccess();case 13:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}}.bind(n))}.bind(this));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.deleteKeyFromDb=function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.deleteKey,a=t.keys,v(n)){e.next=5;break}return e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/key/"+n,{mode:"cors",method:"DELETE"});case 4:this.setState({deleteKey:null,apiKey:"",keys:a.filter((function(e){return e.key!=n}))});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.createKeyEntry=function(e){var t=this;return{content:u.a.createElement("div",null,u.a.createElement("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e})}})," - ",u.a.createElement("span",{style:{cursor:"pointer"},onClick:function(){return t.handleToken(e)}},e)),key:e}},n.getOptions=function(){return this.state.contacts.map((function(e){return{content:e.company_name,value:e.id}}))},n.render=function(){var e=this,t=this.state,n=t.contacts,o=t.contact,r=t.admins,s=(t.admin,t.apiKey),i=t.keys,c=t.isOpen,l=t.locale,x=t.loadingContacts,S=(t.showApiKeys,t.deleteKey),T=t.forHours,O=t.forInvoices,C=t.forQuotes;console.log({locale:l});var j=l?E[l.split("-")[0]]:null;return j?u.a.createElement(d.a,{theme:p.a},u.a.createElement("div",{style:w.mainPadding},u.a.createElement("div",{style:w.mainTable},u.a.createElement(m.a,{content:j.heading}),u.a.createElement(h.a,{gap:"gap.small",vAlign:"center",hAlign:"start"},u.a.createElement(y.a,{justifyContent:"center"},u.a.createElement("form",{style:{width:"100%"}},j.apiSection.title," ",u.a.createElement("br",null),j.apiSection.description,0==r?u.a.createElement(u.a.Fragment,null," ",u.a.createElement("br",null),u.a.createElement(f.a,{content:j.apiSection.fail,style:{background:"#cc4a31",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,r?u.a.createElement(u.a.Fragment,null," ",u.a.createElement("br",null),u.a.createElement(f.a,{content:j.apiSection.succsess,style:{background:"#7fba00",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,u.a.createElement(b.a,{items:i,placeholder:j.apiSection.placeholder,onOpenChange:function(){return e.setState({isOpen:!c})},name:"apiKey",id:"apiKey",clearable:s&&s.length>0,fluid:!0,search:!0,open:c,searchQuery:s,itemToString:function(e){return e?e.key:""},onSearchQueryChange:function(t,n){return e.setState({apiKey:n.searchQuery})},noResultsMessage:{content:"Add... "+s,onClick:function(t){e.setState({isNew:!0,keys:[e.createKeyEntry(s)].concat(Object(a.a)(i)),isOpen:!1})},style:{cursor:"pointer"},active:!0}}),u.a.createElement("br",null),j.contactSection.title," ",u.a.createElement("br",null),j.contactSection.description,u.a.createElement(b.a,{ref:function(t){return e.drop=t},items:n?this.getOptions():[],value:o?o.content:null,placeholder:j.contactSection.placeholder,search:!0,loading:x,loadingMessage:"Loading...",onSearchQueryChange:this.getContacts,onChange:this.updateContact,name:"contact",disabled:!n,itemToString:function(e){return e?e.content:""},fluid:!0}),u.a.createElement("br",null),j.typeSection.title," ",u.a.createElement("br",null),j.typeSection.description," ",u.a.createElement("br",null),u.a.createElement(g.a,{label:j.types[0],checked:O,onChange:function(){return e.setState({forInvoices:!O})}}),u.a.createElement(g.a,{label:j.types[1],checked:C,onChange:function(){return e.setState({forQuotes:!C})}}),u.a.createElement(g.a,{label:j.types[2],checked:T,onChange:function(){return e.setState({forHours:!T})}}),u.a.createElement(k.a,{cancelButton:j.deleteDialog.cancel,onCancel:function(){return e.setState({deleteKey:null})},confirmButton:j.deleteDialog.confirm,onConfirm:this.deleteKeyFromDb,content:j.deleteDialog.message(S),header:j.deleteDialog.header,open:!v(S),backdrop:!0}))))))):null},t}(u.a.Component);t.default=x}}]);
//# sourceMappingURL=component---src-pages-connector-js-6239a0cde7cd211bec8f.js.map